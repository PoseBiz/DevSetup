<VirtualHost *:<%= @params[:server_port] %>>
  ServerAdmin <%= @params[:server_admin] %>
  Servername <%= @params[:server_name] %>
  DocumentRoot <%= @params[:docroot] %>
  <Directory  <%= @params[:docroot] %>>
    Options FollowSymLinks ExecCGI
    AllowOverride None
    Allow from All

    # former symfony .htaccess
    RewriteEngine On
    # we check if the .html version is here (caching)
    RewriteRule ^$ index.html [QSA]
    RewriteRule ^([^.]+)$ $1.html [QSA]
    RewriteCond %{REQUEST_FILENAME} !-f
    # no, so we redirect to our front web controller
    RewriteRule ^(.*)$ index.php [QSA,L]
  </Directory>
 
  Alias /sf <%= @params[:docmainroot] %>/lib/vendor/symfony/data/web/sf
  <Directory "<%= @params[:docmainroot] %>/lib/vendor/symfony/data/web/sf">

    AllowOverride None
    Allow from All  
  </Directory>
 
  RewriteEngine On
  RewriteCond %{HTTP_HOST} !^<%= @params[:server_prefix] %>\<%= @params[:server_suffix] %>$
  RewriteRule ^(.*)$ http://<%= @params[:server_name] %>/$1 [R=permanent,L]
  RewriteCond %{SCRIPT_FILENAME} !-d
  RewriteRule ^\/m(\/?|\/.+)$ /mobileweb$1 [NC]
  RewriteCond %{SCRIPT_FILENAME} !-d
  RewriteRule ^\/(frontend|mobileweb|api)(\/?|\/.*)$ /$1.php$2 [NC,L]
  RewriteCond %{SCRIPT_FILENAME} !-d
  RewriteRule ^\/(robots).txt$ /$1 [NC,L]
  RewriteRule ^\/landing$ / [R=permanent,L]
 
  ErrorLog /var/log/apache2/error.log
  CustomLog /var/log/apache2/access.log combined
</VirtualHost>